<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ëš ì¹´ë¡± ê¸¸ë“œ í¬í„¸</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700;900&display=swap');
        body{font-family:'Noto Sans KR',sans-serif}
        ::-webkit-scrollbar{width:6px;height:6px}::-webkit-scrollbar-track{background:transparent}::-webkit-scrollbar-thumb{background:#fbcfe8;border-radius:4px}::-webkit-scrollbar-thumb:hover{background:#f472b6}
        .fade-in{animation:fadeIn .35s ease-out}@keyframes fadeIn{from{opacity:0;transform:translateY(12px)}to{opacity:1;transform:translateY(0)}}
        #loadingOverlay{position:fixed;inset:0;background:#fff;z-index:10000;display:flex;flex-direction:column;justify-content:center;align-items:center}.force-hide{display:none!important}
        .nav-item.active{background:linear-gradient(135deg,#fdf2f8,#fce7f3);color:#ec4899;box-shadow:inset 4px 0 0 #ec4899}
        #msgBox{transition:all .3s;transform:translateY(100px);opacity:0;pointer-events:none}#msgBox.show{transform:translateY(0);opacity:1}
        th.sortable{cursor:pointer;user-select:none;transition:background .2s}th.sortable:hover{background-color:#fdf2f8!important;color:#db2777!important}
        .score-zero{background-color:#fee2e2!important;color:#ef4444!important}.score-cell{transition:background .2s}.score-cell:hover{background-color:#f8fafb}
        .calendar-grid{display:grid;grid-template-columns:repeat(7,1fr);gap:.25rem;text-align:center;font-size:.75rem}
        .calendar-day{padding:.25rem;border-radius:.75rem;transition:all .2s;min-height:56px;display:flex;flex-direction:column;align-items:center;justify-content:flex-start;aspect-ratio:1/1;cursor:pointer;border:1px solid transparent}
        .calendar-day:hover{background-color:#f9fafb;border-color:#fbcfe8}.calendar-day.today{background-color:#ec4899;color:#fff;font-weight:700}
        .calendar-day.thursday{color:#db2777;background-color:#fdf2f8;border:1px solid #fbcfe8;font-weight:700}.calendar-day.not-current{opacity:.2;pointer-events:none}
        .calendar-head{font-size:.7rem;font-weight:800;color:#9ca3af;text-transform:uppercase;padding-bottom:8px}
        .event-dot{width:4px;height:4px;background-color:#ec4899;border-radius:50%;margin-top:2px}.calendar-day.today .event-dot{background-color:#fff}
        .event-snippet{font-size:11px;color:#db2777;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;width:100%;margin-top:3px;line-height:1.1;font-weight:800;background-color:rgba(251,207,232,.3);border-radius:4px;padding:1px 2px}
        .calendar-day.today .event-snippet{color:#fff;background-color:rgba(255,255,255,.2)}
        @keyframes podiumRise{from{transform:scaleY(0)}to{transform:scaleY(1)}}.podium-bar{transform-origin:bottom;animation:podiumRise .6s ease-out forwards}
    </style>
</head>
<body class="bg-gray-50 text-slate-800 h-screen overflow-hidden flex font-medium">
    <div id="loadingOverlay"><div class="text-center"><div class="animate-spin rounded-full h-16 w-16 border-t-4 border-pink-500 border-opacity-20 border-t-pink-500 mb-8 mx-auto"></div><p class="text-pink-600 font-bold text-xl tracking-tight">ë°ì´í„° ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p><p class="text-gray-400 text-xs mt-2 font-bold">ëš ì¹´ë¡± ê¸¸ë“œ í¬í„¸</p></div></div>
    <div id="msgBox" class="fixed bottom-10 left-1/2 -translate-x-1/2 z-[200] bg-slate-900 text-white px-8 py-4 rounded-2xl shadow-2xl flex items-center gap-4 border border-white/10"><div class="text-pink-500"><i class="fas fa-info-circle"></i></div><p id="msgText" class="text-sm font-bold"></p></div>

    <aside id="sidebar" class="fixed lg:static inset-y-0 left-0 z-50 w-64 bg-white border-r border-gray-100 transform -translate-x-full lg:translate-x-0 transition-transform duration-300 flex flex-col shadow-sm">
        <div class="p-6 border-b border-gray-100 flex items-center gap-3">
            <div class="w-10 h-10 rounded-2xl bg-gradient-to-tr from-pink-400 to-rose-400 flex items-center justify-center text-white font-bold shadow-lg shadow-pink-100 text-xl">ëš </div>
            <div><h1 class="text-lg font-bold text-gray-800 tracking-tight">ëš ì¹´ë¡± í¬í„¸</h1><p class="text-[9px] text-gray-400 font-bold uppercase tracking-widest leading-none mt-1">GUILD MEMBER PORTAL</p></div>
            <button id="closeSidebar" class="lg:hidden ml-auto text-gray-400 hover:text-gray-600"><i class="fas fa-times text-xl"></i></button>
        </div>
        <nav class="p-4 space-y-2 flex-1 overflow-y-auto">
            <button onclick="router('dashboard')" class="nav-item w-full flex items-center space-x-3 px-4 py-3 rounded-xl transition-all text-gray-600 hover:bg-pink-50 font-bold" data-target="dashboard"><i class="fas fa-home w-5 text-center"></i><span>ëŒ€ì‹œë³´ë“œ</span></button>
            <button onclick="router('members')" class="nav-item w-full flex items-center space-x-3 px-4 py-3 rounded-xl transition-all text-gray-600 hover:bg-pink-50 font-bold" data-target="members"><i class="fas fa-users w-5 text-center"></i><span>ê¸¸ë“œì› ëª©ë¡</span></button>
            <button onclick="router('suro')" class="nav-item w-full flex items-center space-x-3 px-4 py-3 rounded-xl transition-all text-gray-600 hover:bg-pink-50 font-bold" data-target="suro"><i class="fas fa-trophy w-5 text-center"></i><span>ìˆ˜ë¡œ ì ìˆ˜ ì¡°íšŒ</span></button>
            <button onclick="router('penalty')" class="nav-item w-full flex items-center space-x-3 px-4 py-3 rounded-xl transition-all text-gray-600 hover:bg-pink-50 font-bold" data-target="penalty"><i class="fas fa-exclamation-triangle w-5 text-center"></i><span>ë²Œì  í˜„í™©</span></button>
            <button onclick="router('bail')" class="nav-item w-full flex items-center space-x-3 px-4 py-3 rounded-xl transition-all text-gray-600 hover:bg-pink-50 font-bold" data-target="bail"><i class="fas fa-gem w-5 text-center"></i><span>ë³´ì„ê¸ˆ í˜„í™©</span></button>
        </nav>
        <div class="p-4 border-t border-gray-100 bg-gray-50/50 text-center"><p class="text-[10px] text-green-500 font-bold uppercase tracking-widest"><i class="fas fa-cloud mr-1 animate-pulse"></i> Read-Only Mode</p><p class="text-[9px] text-gray-400 mt-1 font-bold">ê¸¸ë“œì› ì—´ëŒ ì „ìš©</p></div>
    </aside>
    <div id="sidebarOverlay" class="fixed inset-0 bg-black/10 z-40 hidden lg:hidden"></div>

    <main class="flex-1 flex flex-col overflow-hidden bg-gray-50">
        <header class="h-16 bg-white border-b border-gray-200 flex items-center justify-between px-4 lg:px-8 shrink-0 z-10 shadow-sm">
            <div class="flex items-center gap-4"><button id="openSidebar" class="p-2 lg:hidden rounded-lg hover:bg-gray-100 text-gray-600"><i class="fas fa-bars text-xl"></i></button><h2 id="pageTitle" class="text-lg lg:text-xl font-bold text-gray-800 tracking-tight">ëŒ€ì‹œë³´ë“œ</h2></div>
            <div class="flex items-center gap-2 lg:gap-4">
                <div class="px-3 lg:px-4 py-1.5 bg-pink-50 text-pink-600 rounded-full text-[10px] lg:text-[11px] font-bold border border-pink-100 shadow-sm">âœ¨ <span id="anniversaryLabel">ë¡œë”© ì¤‘...</span></div>
                <div class="hidden md:flex px-4 py-1.5 bg-slate-50 text-slate-600 rounded-full text-[11px] font-bold border border-slate-100 shadow-sm gap-2"><span>ğŸ‘¥</span><span id="totalMembersCount">-</span></div>
                <button onclick="fetchData()" class="w-10 h-10 flex items-center justify-center rounded-xl hover:bg-gray-100 text-gray-400 border border-gray-100 shadow-sm"><i class="fas fa-sync-alt"></i></button>
            </div>
        </header>
        <div id="contentArea" class="flex-1 overflow-y-auto p-3 lg:p-6 relative bg-gray-50 flex flex-col min-h-0"></div>
    </main>

    <nav class="fixed bottom-0 left-0 right-0 z-50 bg-white border-t border-gray-200 flex justify-around items-center py-2 px-1 shadow-lg lg:hidden">
        <button onclick="router('dashboard')" class="mobile-tab flex flex-col items-center gap-0.5 px-2 py-1" data-target="dashboard"><i class="fas fa-home text-sm"></i><span class="text-[9px] font-bold">í™ˆ</span></button>
        <button onclick="router('members')" class="mobile-tab flex flex-col items-center gap-0.5 px-2 py-1" data-target="members"><i class="fas fa-users text-sm"></i><span class="text-[9px] font-bold">ê¸¸ë“œì›</span></button>
        <button onclick="router('suro')" class="mobile-tab flex flex-col items-center gap-0.5 px-2 py-1" data-target="suro"><i class="fas fa-trophy text-sm"></i><span class="text-[9px] font-bold">ìˆ˜ë¡œ</span></button>
        <button onclick="router('penalty')" class="mobile-tab flex flex-col items-center gap-0.5 px-2 py-1" data-target="penalty"><i class="fas fa-exclamation-triangle text-sm"></i><span class="text-[9px] font-bold">ë²Œì </span></button>
        <button onclick="router('bail')" class="mobile-tab flex flex-col items-center gap-0.5 px-2 py-1" data-target="bail"><i class="fas fa-gem text-sm"></i><span class="text-[9px] font-bold">ë³´ì„ê¸ˆ</span></button>
    </nav>

    <div id="eventDetailModal" class="fixed inset-0 z-[120] flex items-center justify-center bg-black/40 backdrop-blur-sm hidden fade-in font-bold">
        <div class="bg-white rounded-[2.5rem] shadow-2xl w-full max-w-sm p-10 border border-gray-50 flex flex-col max-h-[85vh] mx-4">
            <div class="flex justify-between items-center mb-6 shrink-0"><h3 id="eventDetailDate" class="text-2xl font-black text-slate-800 tracking-tighter"></h3><button onclick="document.getElementById('eventDetailModal').classList.add('hidden')" class="text-gray-400 hover:text-gray-600 text-xl"><i class="fas fa-times"></i></button></div>
            <div id="eventListContent" class="flex-1 overflow-y-auto space-y-3"></div>
        </div>
    </div>

    <script>
    var SCRIPT_URL="https://script.google.com/macros/s/AKfycbwggYNNELvf6Onk9EQoYJPLXWMAtchkRpoNuOtHyp_Scjo3mqj2TQOBvvdR4yEnXoGVTw/exec";
    var GUILD_START=new Date('2020-03-17'),PPG=20,chartInst=null;
    var G=[{name:'ëš ì¹´ë¡±',type:'ë©”ì¸ 1ê¸°',icon:'fa-crown',max:200},{name:'ëš±ì¹´ë¡±',type:'ë©”ì¸ 2ê¸°',icon:'fa-heart',max:200},{name:'ë°¤ì¹´ë¡±',type:'ë¶€ìº 1ê¸°',icon:'fa-moon',max:200},{name:'ë³„ì¹´ë¡±',type:'ë¶€ìº 2ê¸°',icon:'fa-star',max:200},{name:'ë‹¬ì¹´ë¡±',type:'ë¶€ìº 3ê¸°',icon:'fa-sun',max:200},{name:'ê¿€ì¹´ë¡±',type:'ë¶€ìº 4ê¸°',icon:'fa-cube',max:200}];
    var app={tab:'dashboard',members:[],suroH:[],bail:[],events:[],penalty:[],f:{guild:'all',search:'',sf:'name',so:'asc'},sf:{guild:'ëš ì¹´ë¡±',search:'',sf:'avg',so:'desc'},cal:{y:new Date().getFullYear(),m:new Date().getMonth()},pg:{m:1,s:1}};

    function msg(t){document.getElementById('msgText').innerText=t;document.getElementById('msgBox').classList.add('show');setTimeout(function(){document.getElementById('msgBox').classList.remove('show')},3e3)}
    function load(v){document.getElementById('loadingOverlay').classList.toggle('force-hide',!v)}
    function icon(r){if(r==='ë§ˆì¹´ë¡±')return'<i class="fas fa-crown text-blue-500 mr-1.5"></i>';if(r==='ë‹¤ì¿ ì•„ì¦ˆ')return'<i class="fas fa-crown text-pink-500 mr-1.5"></i>';return'<span class="w-2.5 h-2.5 rounded-full bg-gray-200 mr-1.5 inline-block"></span>'}
    function fmtRank(r){if(!r)return'-';if(['í¬ë¼ìš´','íŒŒë¥´í˜','í‹°ë¼ë¯¸ìŠˆ','í¬ë¡œì¹¸ìŠˆ'].indexOf(r)!==-1)return r+' <span class="text-[8px] text-blue-500 font-bold">(ì•„ì¸ìŠˆí˜ë„ˆ)</span>';return r}
    function suroTotal(g){if(!app.suroH.length)return 0;var h=app.suroH[app.suroH.length-1];return app.members.filter(function(m){return m.guild===g}).reduce(function(s,m){return s+(Number(m.suro&&m.suro[h])||0)},0)}
    function bailStats(){var s={};app.bail.forEach(function(h){s[h.receiver]=(s[h.receiver]||0)+(parseInt(h.amount)||0)});return Object.entries(s).sort(function(a,b){return a[0].localeCompare(b[0],'ko')})}
    function cmp(a,b,f,o){var vA=f==='mainInfo'?(a.isMain?a.name:(a.mainCharName||'')):a[f],vB=f==='mainInfo'?(b.isMain?b.name:(b.mainCharName||'')):b[f];if(vA===vB)return 0;var nA=parseFloat(vA),nB=parseFloat(vB);if(!isNaN(nA)&&!isNaN(nB))return o==='asc'?nA-nB:nB-nA;var r=String(vA||'')<String(vB||'')?-1:1;return o==='asc'?r:-r}
    function chgPg(t,d){app.pg[t==='members'?'m':'s']+=d;if(t==='members')updMemTbl();else renderSuro(document.getElementById('contentArea'))}
    window.changePage=chgPg;

    function fetchData(){
        load(true);
        fetch(SCRIPT_URL+"?t="+Date.now(),{method:'GET',mode:'cors',cache:'no-cache',redirect:'follow'}).then(function(r){return r.json()}).then(function(j){
            if(j.status==="success"){
                app.members=(j.data.members||[]).map(function(m){m.id=String(m.id);return m}).filter(function(m){return m.name&&m.name.trim()});
                app.suroH=j.data.suroHeaders||[];app.bail=j.data.bailHistory||[];
                app.events=(j.data.events||[]).map(function(e){return{date:(e.date||'').split('T')[0].trim(),title:e.title,content:e.content}});
                app.penalty=j.data.penaltyHistory||[];
                var c={};G.forEach(function(g){c[g.name]=0});app.members.forEach(function(m){if(c[m.guild]!==undefined)c[m.guild]++});
                var al={'ëš ì¹´ë¡±':'ëš ','ëš±ì¹´ë¡±':'ëš±','ë°¤ì¹´ë¡±':'ë°¤','ë³„ì¹´ë¡±':'ë³„','ë‹¬ì¹´ë¡±':'ë‹¬','ê¿€ì¹´ë¡±':'ê¿€'};
                document.getElementById('totalMembersCount').innerText=G.map(function(g){return(al[g.name]||g.name[0])+':'+c[g.name]}).join(' ');
                var a=new Date()-GUILD_START,d=Math.floor(a/864e5);
                document.getElementById('anniversaryLabel').innerText='ëš ì¹´ë¡± '+d+'ì¼ ('+Math.floor(d/365)+'ë…„ '+(d%365)+'ì¼)';
                router(app.tab);
            }else msg("ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.");
            load(false);
        }).catch(function(e){console.error(e);msg("ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜");load(false)});
    }
    window.fetchData=fetchData;

    function router(tab){
        app.tab=tab;var c=document.getElementById('contentArea');c.innerHTML='';
        document.querySelectorAll('.nav-item').forEach(function(el){el.classList.toggle('active',el.dataset.target===tab)});
        document.querySelectorAll('.mobile-tab').forEach(function(el){var a=el.dataset.target===tab;el.classList.toggle('text-pink-500',a);el.classList.toggle('text-gray-400',!a)});
        var t={dashboard:'ê¸¸ë“œ í˜„í™©íŒ',members:'ê¸¸ë“œì› ëª©ë¡',suro:'ìˆ˜ë¡œ ì ìˆ˜ ì¡°íšŒ',bail:'ë³´ì„ê¸ˆ í˜„í™©',penalty:'ë²Œì  ê´€ë¦¬ í˜„í™©'};
        document.getElementById('pageTitle').innerText=t[tab]||'';
        if(tab==='dashboard')renderDash(c);else if(tab==='members')renderMem(c);else if(tab==='suro')renderSuro(c);
        else if(tab==='penalty')renderPenalty(c);
        else if(tab==='bail')renderBail(c);
    }
    window.router=router;

    // === DASHBOARD ===
    function renderDash(c){
        var d1=suroTotal('ëš ì¹´ë¡±'),d2=suroTotal('ëš±ì¹´ë¡±'),bs=bailStats(),bh='';
        if(!bs.length)bh='<p class="text-[10px] text-gray-300 italic text-center py-4">ë‚´ì—­ ì—†ìŒ</p>';
        else bs.forEach(function(i){bh+='<div class="flex justify-between items-center py-2.5 border-b border-gray-50 last:border-0"><span class="text-[11px] font-bold text-gray-600">'+i[0]+'</span><span class="text-[11px] font-black text-pink-500">'+i[1]+'ê°œ</span></div>'});
        var gc='';G.forEach(function(g){var n=app.members.filter(function(m){return m.guild===g.name}).length,p=Math.min(n/g.max*100,100);
            gc+='<div class="bg-white p-5 lg:p-6 rounded-[1.5rem] lg:rounded-[2rem] border border-gray-100 shadow-sm hover:shadow-md transition-all cursor-pointer group" onclick="app.f.guild=\''+g.name+'\';router(\'members\')">'
            +'<div class="flex items-center gap-2 mb-3"><div class="w-8 h-8 bg-gray-50 rounded-xl flex items-center justify-center text-gray-400 group-hover:bg-pink-50 group-hover:text-pink-500 text-xs"><i class="fas '+g.icon+'"></i></div>'
            +'<div><span class="block font-bold text-sm text-gray-800 group-hover:text-pink-500 leading-tight">'+g.name+'</span><span class="text-[9px] text-gray-400 font-bold">'+g.type+'</span></div></div>'
            +'<div class="w-full bg-gray-50 rounded-full h-1 overflow-hidden"><div class="h-full bg-pink-500" style="width:'+p+'%"></div></div>'
            +'<p class="text-[10px] text-gray-400 font-bold mt-1.5 text-right">'+n+' / '+g.max+'</p></div>'});
        var cv=app.cal;
        c.innerHTML='<div class="grid grid-cols-1 xl:grid-cols-2 gap-6 lg:gap-8 mb-6 lg:mb-8 fade-in shrink-0"><div class="flex flex-col gap-6">'
            +'<div class="flex gap-4 lg:gap-6 h-32 lg:h-40">'
            +'<div onclick="app.sf.guild=\'ëš ì¹´ë¡±\';router(\'suro\')" class="flex-1 bg-gradient-to-br from-pink-500 to-rose-500 rounded-[2rem] lg:rounded-[2.5rem] p-6 lg:p-8 shadow-lg text-white cursor-pointer hover:scale-[1.02] transition-transform relative overflow-hidden flex flex-col justify-center"><div class="absolute top-0 right-0 p-4 opacity-20 text-4xl lg:text-5xl"><i class="fas fa-crown"></i></div><h3 class="text-xs font-bold opacity-80 uppercase tracking-widest text-center">ëš ì¹´ë¡± ìˆ˜ë¡œ</h3><p class="text-2xl lg:text-3xl font-black tracking-tighter text-center">'+d1.toLocaleString()+'</p></div>'
            +'<div onclick="app.sf.guild=\'ëš±ì¹´ë¡±\';router(\'suro\')" class="flex-1 bg-white border border-gray-100 rounded-[2rem] lg:rounded-[2.5rem] p-6 lg:p-8 shadow-sm cursor-pointer hover:border-pink-200 flex flex-col justify-center"><h3 class="text-xs font-bold text-gray-400 uppercase tracking-widest text-center">ëš±ì¹´ë¡± ìˆ˜ë¡œ</h3><p class="text-2xl lg:text-3xl font-black tracking-tighter text-pink-500 text-center">'+d2.toLocaleString()+'</p></div></div>'
            +'<div class="bg-white p-6 lg:p-8 rounded-[2rem] lg:rounded-[2.5rem] border border-gray-100 min-h-[320px] shadow-sm flex flex-col">'
            +'<div class="flex justify-between items-center mb-6"><div class="flex items-center gap-3"><span class="text-2xl">ğŸ“…</span><h3 class="text-xs font-bold text-gray-400 uppercase tracking-widest">ê¸¸ë“œ ì¼ì •</h3></div>'
            +'<div class="flex items-center gap-2 bg-gray-50 px-3 py-1.5 rounded-2xl border border-gray-100"><button onclick="moveMo(-1)" class="w-6 h-6 flex items-center justify-center rounded-lg hover:bg-white hover:text-pink-500 text-gray-400"><i class="fas fa-chevron-left text-[10px]"></i></button><span class="text-[11px] font-bold text-gray-600 w-16 text-center">'+cv.y+'.'+String(cv.m+1).padStart(2,'0')+'</span><button onclick="moveMo(1)" class="w-6 h-6 flex items-center justify-center rounded-lg hover:bg-white hover:text-pink-500 text-gray-400"><i class="fas fa-chevron-right text-[10px]"></i></button></div></div>'
            +renderCal()+'</div></div>'
            +'<div class="flex flex-col gap-6 lg:gap-8"><div class="grid grid-cols-2 lg:grid-cols-3 gap-3 lg:gap-4">'+gc+'</div>'
            +'<div class="bg-white p-8 lg:p-10 rounded-[2.5rem] lg:rounded-[3rem] shadow-sm border border-gray-100 flex flex-col flex-1 min-h-[180px] overflow-hidden"><div class="flex items-center justify-between mb-6"><h3 class="text-sm font-bold text-gray-400 uppercase tracking-widest">ê°„ë¶€ì§„ ë³´ì„ê¸ˆ í˜„í™©</h3><i class="fas fa-gem text-pink-300"></i></div><div class="flex-1 overflow-y-auto pr-2">'+bh+'</div></div></div></div>';
    }

    function moveMo(d){var m=app.cal.m+d,y=app.cal.y;if(m<0){m=11;y--}else if(m>11){m=0;y++}app.cal={y:y,m:m};router('dashboard')}
    window.moveMo=moveMo;

    function renderCal(){
        var y=app.cal.y,mo=app.cal.m,f=new Date(y,mo,1).getDay(),la=new Date(y,mo+1,0).getDate(),pl=new Date(y,mo,0).getDate(),td=new Date();
        var h='<div class="calendar-grid"><div class="calendar-head text-red-400">ì¼</div><div class="calendar-head">ì›”</div><div class="calendar-head">í™”</div><div class="calendar-head">ìˆ˜</div><div class="calendar-head text-pink-500">ëª©</div><div class="calendar-head">ê¸ˆ</div><div class="calendar-head text-blue-400">í† </div>';
        for(var i=f;i>0;i--)h+='<div class="calendar-day not-current"><span>'+(pl-i+1)+'</span></div>';
        for(var d=1;d<=la;d++){var ds=y+'-'+String(mo+1).padStart(2,'0')+'-'+String(d).padStart(2,'0');
            var ev=app.events.filter(function(e){return e.date===ds}),isT=td.getFullYear()===y&&td.getMonth()===mo&&td.getDate()===d,isTh=new Date(y,mo,d).getDay()===4;
            var cl="calendar-day text-gray-600";if(isTh)cl+=" thursday";if(isT)cl+=" today";var eh='';
            if(ev.length>0){eh+='<div class="event-dot"></div>';ev.slice(0,2).forEach(function(e){eh+='<div class="event-snippet" title="'+e.title+'">'+e.title+'</div>'});if(ev.length>2)eh+='<div class="text-[9px] text-pink-400 mt-0.5 font-bold">+'+(ev.length-2)+'</div>'}
            h+='<div class="'+cl+'" onclick="showEvt(\''+ds+'\')"><span>'+d+'</span>'+eh+'</div>'}
        var ex=(7-((f+la)%7))%7;for(var i=1;i<=ex;i++)h+='<div class="calendar-day not-current"><span>'+i+'</span></div>';
        return h+'</div>';
    }

    function showEvt(ds){
        var ev=app.events.filter(function(e){return e.date===ds});document.getElementById('eventDetailDate').innerText=ds;var el=document.getElementById('eventListContent');
        if(!ev.length){el.innerHTML='<div class="text-center py-10"><i class="fas fa-calendar-day text-gray-200 text-3xl mb-4"></i><p class="text-sm text-gray-400 font-bold">ë“±ë¡ëœ ì¼ì •ì´ ì—†ìŠµë‹ˆë‹¤.</p></div>'}
        else{var h='';ev.forEach(function(e){h+='<div class="p-5 bg-pink-50/50 border border-pink-100 rounded-2xl"><div class="flex items-center gap-2 mb-2"><div class="w-2 h-2 bg-pink-500 rounded-full"></div><h4 class="font-bold text-sm text-gray-800">'+e.title+'</h4></div>'+(e.content?'<p class="text-xs text-gray-500 ml-4 leading-relaxed">'+e.content+'</p>':'')+'</div>'});el.innerHTML=h}
        document.getElementById('eventDetailModal').classList.remove('hidden');
    }
    window.showEvt=showEvt;

    // === MEMBERS ===
    function renderMem(c){
        var th='<button onclick="app.f.guild=\'all\';app.pg.m=1;updMemTbl()" class="shrink-0 px-4 py-2 rounded-xl text-xs font-bold '+(app.f.guild==='all'?'bg-gray-800 text-white shadow-md':'bg-gray-50 text-gray-500')+'">ì „ì²´</button>';
        G.forEach(function(g){th+='<button onclick="app.f.guild=\''+g.name+'\';app.pg.m=1;updMemTbl()" class="shrink-0 px-4 py-2 rounded-xl text-xs font-bold '+(app.f.guild===g.name?'bg-pink-500 text-white shadow-md':'bg-gray-50 text-gray-500')+'">'+g.name+'</button>'});
        c.innerHTML='<div class="flex flex-col gap-3 fade-in h-full"><div class="bg-white p-3 lg:p-4 rounded-2xl border border-gray-100 shadow-sm flex flex-col xl:flex-row items-center gap-3 lg:gap-4 shrink-0"><div class="flex overflow-x-auto w-full xl:w-auto gap-2 shrink-0">'+th+'</div><div class="relative flex-1 w-full"><i class="fas fa-search absolute left-4 top-1/2 -translate-y-1/2 text-gray-400 text-xs"></i><input type="text" oninput="app.f.search=this.value;app.pg.m=1;updMemTbl()" value="'+app.f.search+'" class="w-full pl-10 pr-4 py-2.5 bg-gray-50 border border-gray-100 rounded-xl outline-none text-xs font-bold shadow-inner focus:ring-2 focus:ring-pink-50" placeholder="ë‹‰ë„¤ì„, ì§ìœ„, ì§ì—…, ë³¸ìºëª… ê²€ìƒ‰"></div></div><div id="mtc" class="bg-white rounded-2xl border border-gray-100 overflow-hidden shadow-sm flex-1 min-h-0 flex flex-col"></div></div>';
        updMemTbl();
    }

    function updMemTbl(){
        var cn=document.getElementById('mtc');if(!cn)return;var t=app.f.search.toLowerCase();
        var fl=app.members.filter(function(m){var g=app.f.guild==='all'||m.guild===app.f.guild;var s=m.name.toLowerCase().indexOf(t)!==-1||(m.class||'').toLowerCase().indexOf(t)!==-1||(m.role||'').toLowerCase().indexOf(t)!==-1||(m.mainCharName||'').toLowerCase().indexOf(t)!==-1;return g&&s});
        fl.sort(function(a,b){return cmp(a,b,app.f.sf,app.f.so)});
        var tot=fl.length,pgs=Math.ceil(tot/PPG)||1;if(app.pg.m>pgs)app.pg.m=pgs;if(app.pg.m<1)app.pg.m=1;
        var pg=fl.slice((app.pg.m-1)*PPG,app.pg.m*PPG);
        function si(f){return app.f.sf===f?(app.f.so==='asc'?' <i class="fas fa-sort-up"></i>':' <i class="fas fa-sort-down"></i>'):''}
        var h='<div class="overflow-auto flex-1"><table class="w-full text-left min-w-[800px] text-xs whitespace-nowrap"><thead class="bg-gray-50 text-[10px] font-bold text-gray-500 border-b border-gray-100 sticky top-0 z-10"><tr><th class="p-4 text-center w-14">No.</th><th class="p-4 sortable" onclick="memSort(\'name\')">ë‹‰ë„¤ì„'+si('name')+'</th><th class="p-4 sortable" onclick="memSort(\'mainInfo\')">ë³¸ìº ì •ë³´'+si('mainInfo')+'</th><th class="p-4 sortable" onclick="memSort(\'guild\')">ì†Œì†'+si('guild')+'</th><th class="p-4 sortable" onclick="memSort(\'role\')">ì§ìœ„'+si('role')+'</th><th class="p-4 sortable" onclick="memSort(\'class\')">ì§ì—…'+si('class')+'</th></tr></thead><tbody class="divide-y divide-gray-50 text-gray-600 font-bold">';
        pg.forEach(function(m,i){var gi=(app.pg.m-1)*PPG+i+1,mn=m.isMain?m.name:(m.mainCharName||'-'),mm=app.members.find(function(x){return x.name===mn}),mr=mm?fmtRank(mm.role):'-',ms='',mt='text-gray-700',st='text-gray-400',tr=mm?mm.role:(m.isMain?m.role:'');
            if(['í‹°ë¼ë¯¸ìŠˆ','íŒŒë¥´í˜','í¬ë¼ìš´'].indexOf(tr)!==-1){ms='background-color:#0066FF;';mt='text-white';st='text-white opacity-80'}else if(tr==='í¬ë¡œì¹¸ìŠˆ'){ms='background-color:#92D050;';mt='text-black';st='text-black opacity-80'}
            var rh='<span class="text-[10px]">'+m.role+'</span>';if(m.role==='ì•„ì¸ìŠˆí˜ë„ˆ')rh='<span class="inline-block px-2 py-0.5 rounded text-[10px] font-bold text-white shadow-sm" style="background-color:#FF99FF">'+m.role+'</span>';
            h+='<tr class="hover:bg-pink-50/20 transition-colors h-12"><td class="p-3 text-center text-gray-400 text-[11px]">'+gi+'</td><td class="p-3 font-bold text-gray-800 flex items-center h-full leading-none">'+icon(m.role)+'<span class="text-sm tracking-tight">'+m.name+'</span></td><td class="p-3 leading-tight"><div class="rounded-xl p-2 -m-1" style="'+ms+'"><span class="block text-[11px] font-bold '+mt+'">'+mn+'</span><span class="text-[9px] font-medium '+st+'">'+mr+'</span></div></td><td class="p-3 text-[11px]">'+m.guild+'</td><td class="p-3">'+rh+'</td><td class="p-3"><span class="text-[10px] text-gray-400">'+(m.class||'-')+'</span></td></tr>'});
        h+='</tbody></table></div><div class="p-3 border-t border-gray-100 flex justify-between items-center bg-gray-50/50"><span class="text-[10px] text-gray-400 font-bold ml-2">ì´ '+tot+'ëª…</span><div class="flex items-center gap-4"><button onclick="changePage(\'members\',-1)" class="w-8 h-8 flex items-center justify-center rounded-xl bg-white border border-gray-200 text-gray-500 hover:bg-pink-50 disabled:opacity-30" '+(app.pg.m<=1?'disabled':'')+'><i class="fas fa-chevron-left text-[10px]"></i></button><span class="text-xs font-bold text-gray-500">'+app.pg.m+' / '+pgs+'</span><button onclick="changePage(\'members\',1)" class="w-8 h-8 flex items-center justify-center rounded-xl bg-white border border-gray-200 text-gray-500 hover:bg-pink-50 disabled:opacity-30" '+(app.pg.m>=pgs?'disabled':'')+'><i class="fas fa-chevron-right text-[10px]"></i></button></div></div>';
        cn.innerHTML=h;
    }
    window.updMemTbl=updMemTbl;
    function memSort(f){if(app.f.sf===f)app.f.so=app.f.so==='asc'?'desc':'asc';else{app.f.sf=f;app.f.so='asc'}app.pg.m=1;updMemTbl()}
    window.memSort=memSort;

    // === SURO ===
    function renderSuro(c){
        var gN=app.sf.guild,tg=app.members.filter(function(m){return m.guild===gN}),rH=app.suroH.slice(-5),cH=rH[rH.length-1],tot=suroTotal(gN);
        var zc=tg.filter(function(m){return(Number(m.suro&&m.suro[cH])||0)===0}).length;
        var pr=tg.map(function(m){var sc=rH.map(function(h){return Number(m.suro&&m.suro[h])||0}),av=sc.length?(sc.reduce(function(a,b){return a+b},0)/sc.length):0;return{name:m.name,role:m.role,avg:Number(av.toFixed(1)),cur:Number(m.suro&&m.suro[cH])||0,sc:sc}});
        var st=app.sf.search.toLowerCase(),fl=st?pr.filter(function(m){return m.name.toLowerCase().indexOf(st)!==-1}):pr;
        var sf=app.sf.sf,so=app.sf.so;fl.sort(function(a,b){if(sf==='avg')return so==='asc'?a.avg-b.avg:b.avg-a.avg;if(sf==='current')return so==='asc'?a.cur-b.cur:b.cur-a.cur;return cmp(a,b,sf,so)});
        var ti=fl.length,pgs=Math.ceil(ti/PPG)||1;if(app.pg.s>pgs)app.pg.s=pgs;if(app.pg.s<1)app.pg.s=1;
        var pd=fl.slice((app.pg.s-1)*PPG,app.pg.s*PPG);
        function si(f){return app.sf.sf===f?(app.sf.so==='asc'?' <i class="fas fa-sort-up"></i>':' <i class="fas fa-sort-down"></i>'):''}
        var t3=[].concat(pr).sort(function(a,b){return b.cur-a.cur}).slice(0,3),po='';
        if(t3.length>=2)po+='<div class="flex flex-col items-center"><span class="text-[10px] font-bold text-gray-500 mb-1">'+t3[1].name+'</span><div class="w-14 lg:w-16 bg-gray-200 rounded-t-xl podium-bar flex items-center justify-center" style="height:70px;animation-delay:.2s"><span class="text-xs font-black text-gray-600">'+t3[1].cur.toLocaleString()+'</span></div><div class="w-14 lg:w-16 bg-gray-300 text-center py-1 rounded-b text-[10px] font-black text-white">2nd</div></div>';
        if(t3.length>=1)po+='<div class="flex flex-col items-center"><span class="text-[10px] font-bold text-pink-500 mb-1">ğŸ‘‘ '+t3[0].name+'</span><div class="w-14 lg:w-16 bg-pink-500 rounded-t-xl podium-bar flex items-center justify-center" style="height:100px"><span class="text-xs font-black text-white">'+t3[0].cur.toLocaleString()+'</span></div><div class="w-14 lg:w-16 bg-pink-600 text-center py-1 rounded-b text-[10px] font-black text-white">1st</div></div>';
        if(t3.length>=3)po+='<div class="flex flex-col items-center"><span class="text-[10px] font-bold text-gray-500 mb-1">'+t3[2].name+'</span><div class="w-14 lg:w-16 bg-gray-100 rounded-t-xl podium-bar flex items-center justify-center" style="height:50px;animation-delay:.4s"><span class="text-xs font-black text-gray-500">'+t3[2].cur.toLocaleString()+'</span></div><div class="w-14 lg:w-16 bg-gray-200 text-center py-1 rounded-b text-[10px] font-black text-gray-500">3rd</div></div>';

        var tb='';G.forEach(function(g){tb+='<button onclick="app.sf.guild=\''+g.name+'\';app.sf.search=\'\';app.pg.s=1;renderSuro(document.getElementById(\'contentArea\'))" class="px-5 lg:px-6 py-2.5 rounded-xl text-xs font-bold shrink-0 '+(g.name===gN?'bg-pink-500 text-white shadow-lg':'bg-white text-gray-500 border border-gray-100')+'">'+g.name+'</button>'});
        var pH=rH.slice(0,-1),pTh='';pH.forEach(function(h){pTh+='<th class="p-4 text-right font-medium hidden lg:table-cell">'+h.split('~')[0].trim()+'</th>'});
        var rw='';pd.forEach(function(m,i){var rk=(app.pg.s-1)*PPG+i+1,bd='<span class="text-gray-300">'+rk+'</span>';if(rk===1)bd='<span class="text-yellow-500">ğŸ¥‡</span>';else if(rk===2)bd='<span class="text-gray-400">ğŸ¥ˆ</span>';else if(rk===3)bd='<span class="text-orange-400">ğŸ¥‰</span>';
            var pt='';m.sc.slice(0,-1).forEach(function(s){pt+='<td class="p-4 text-right font-mono hidden lg:table-cell score-cell '+(s===0?'score-zero':'text-gray-400')+'">'+(s>0?s.toLocaleString():'0')+'</td>'});
            rw+='<tr class="hover:bg-gray-50 transition-colors h-12"><td class="p-4 text-center">'+bd+'</td><td class="p-4 text-gray-800 flex items-center leading-none">'+icon(m.role)+m.name+'</td><td class="p-4 text-center text-pink-500 bg-pink-50/20">'+m.avg.toLocaleString()+'</td><td class="p-4 text-center font-mono '+(m.cur===0?'score-zero':'text-gray-700 font-black')+'">'+(m.cur>0?m.cur.toLocaleString():'0')+'</td>'+pt+'</tr>'});

        c.innerHTML='<div class="flex flex-col gap-4 lg:gap-6 fade-in h-full overflow-hidden"><div class="flex gap-2 overflow-x-auto shrink-0">'+tb+'</div>'
            +'<div class="grid grid-cols-3 gap-3 lg:gap-4 shrink-0 font-bold"><div class="bg-white p-4 lg:p-6 rounded-[1.5rem] lg:rounded-[2rem] border border-gray-100 shadow-sm flex flex-col justify-center items-center"><p class="text-[9px] lg:text-[10px] text-gray-400 font-bold uppercase tracking-widest mb-1">ì „ì²´ ì´ì </p><h4 class="text-xl lg:text-3xl font-black text-gray-800 tracking-tighter">'+tot.toLocaleString()+'</h4></div><div class="bg-red-50 p-4 lg:p-6 rounded-[1.5rem] lg:rounded-[2rem] border border-red-100 shadow-sm flex flex-col justify-center items-center"><p class="text-[9px] lg:text-[10px] text-red-500 font-bold uppercase tracking-widest mb-1">ğŸš¨ ë¯¸ì°¸ì—¬</p><h4 class="text-xl lg:text-3xl font-black text-red-600 tracking-tighter">'+zc+'ëª…</h4></div><div class="bg-white p-4 lg:p-6 rounded-[1.5rem] lg:rounded-[2rem] border border-gray-100 shadow-sm flex flex-col justify-center items-center"><p class="text-[9px] lg:text-[10px] text-gray-400 font-bold uppercase tracking-widest mb-1">ë°ì´í„° ì£¼ì°¨</p><h4 class="text-[10px] lg:text-sm font-bold text-gray-700">'+(cH?cH.split(' ')[0]:'-')+'</h4></div></div>'
            +'<div class="grid grid-cols-1 lg:grid-cols-3 gap-4 lg:gap-6 shrink-0"><div class="bg-white p-6 lg:p-8 rounded-[2rem] lg:rounded-[2.5rem] border border-gray-100 shadow-sm flex flex-col items-center justify-center min-h-[200px]"><h3 class="text-xs font-bold text-gray-400 mb-6 uppercase tracking-widest">ğŸ† ì´ë²ˆì£¼ TOP 3</h3><div class="flex items-end gap-4 lg:gap-6 h-[120px]">'+po+'</div></div><div class="lg:col-span-2 bg-white p-6 lg:p-8 rounded-[2rem] lg:rounded-[2.5rem] border border-gray-100 shadow-sm flex flex-col min-h-[200px]"><h3 class="text-xs font-bold text-gray-400 mb-4 uppercase tracking-widest">ì£¼ê°„ ì´ì  ì¶”ì´</h3><div class="flex-1 min-h-[150px]"><canvas id="suroChart"></canvas></div></div></div>'
            +'<div class="bg-white rounded-2xl border border-gray-100 shadow-sm overflow-hidden flex-1 min-h-0 flex flex-col"><div class="p-4 border-b border-gray-50 flex flex-col sm:flex-row justify-between items-start sm:items-center gap-3 shrink-0"><h3 class="text-sm font-bold text-gray-800 uppercase tracking-widest">ìˆ˜ë¡œ ì ìˆ˜ ë­í‚¹</h3><div class="relative w-full sm:w-64"><i class="fas fa-search absolute left-3 top-1/2 -translate-y-1/2 text-gray-400 text-xs"></i><input type="text" oninput="app.sf.search=this.value;app.pg.s=1;renderSuro(document.getElementById(\'contentArea\'))" value="'+app.sf.search+'" class="w-full pl-9 pr-4 py-2 bg-gray-50 border border-gray-100 rounded-xl outline-none text-xs font-bold shadow-inner focus:ring-2 focus:ring-pink-50" placeholder="ë‹‰ë„¤ì„ ê²€ìƒ‰"></div></div>'
            +'<div class="flex-1 overflow-auto"><table class="w-full text-left text-xs whitespace-nowrap min-w-[700px]"><thead class="bg-gray-50 font-bold text-[10px] text-gray-500 uppercase sticky top-0 z-10 border-b border-gray-100"><tr><th class="p-4 w-14 text-center">RANK</th><th class="p-4 sortable" onclick="suroSort(\'name\')">ìºë¦­í„°ëª…'+si('name')+'</th><th class="p-4 text-center sortable bg-pink-50/50" onclick="suroSort(\'avg\')">í‰ê· '+si('avg')+'</th><th class="p-4 text-center sortable bg-yellow-50/50" onclick="suroSort(\'current\')">ì´ë²ˆì£¼'+si('current')+'</th>'+pTh+'</tr></thead><tbody class="divide-y divide-gray-50 font-bold">'+rw+'</tbody></table></div>'
            +'<div class="p-3 border-t border-gray-100 flex justify-between items-center bg-gray-50/50"><span class="text-[10px] text-gray-400 font-bold ml-2">ì´ '+ti+'ëª…</span><div class="flex items-center gap-4"><button onclick="changePage(\'suro\',-1)" class="w-8 h-8 flex items-center justify-center rounded-xl bg-white border border-gray-200 text-gray-500 hover:bg-pink-50 disabled:opacity-30" '+(app.pg.s<=1?'disabled':'')+'><i class="fas fa-chevron-left text-[10px]"></i></button><span class="text-xs font-bold text-gray-500">'+app.pg.s+' / '+pgs+'</span><button onclick="changePage(\'suro\',1)" class="w-8 h-8 flex items-center justify-center rounded-xl bg-white border border-gray-200 text-gray-500 hover:bg-pink-50 disabled:opacity-30" '+(app.pg.s>=pgs?'disabled':'')+'><i class="fas fa-chevron-right text-[10px]"></i></button></div></div></div></div>';

        var cx=document.getElementById('suroChart');
        if(cx){if(chartInst)chartInst.destroy();chartInst=new Chart(cx,{type:'line',data:{labels:rH.map(function(h){var p=h?h.split('-'):[];return p.length>=3?p[1]+'-'+p[2].substring(0,2):h}),datasets:[{label:'ì´ì ',data:rH.map(function(h){return app.members.filter(function(m){return m.guild===gN}).reduce(function(s,m){return s+(Number(m.suro&&m.suro[h])||0)},0)}),borderColor:'#ec4899',borderWidth:3,pointRadius:5,pointBackgroundColor:'#fff',tension:.4,fill:true,backgroundColor:'rgba(236,72,153,.05)'}]},options:{responsive:true,maintainAspectRatio:false,plugins:{legend:{display:false}},scales:{y:{display:false},x:{grid:{display:false},ticks:{font:{size:10,weight:'bold'}}}}}})}
    }
    window.renderSuro=renderSuro;
    function suroSort(f){if(app.sf.sf===f)app.sf.so=app.sf.so==='asc'?'desc':'asc';else{app.sf.sf=f;app.sf.so=(f==='avg'||f==='current')?'desc':'asc'}app.pg.s=1;renderSuro(document.getElementById('contentArea'))}
    window.suroSort=suroSort;

    // === BAIL ===
    function renderBail(c){
        var st=bailStats(),sh='';st.forEach(function(i){sh+='<div class="bg-gray-50 rounded-2xl p-4 flex justify-between items-center border border-gray-100 hover:bg-white shadow-sm"><span class="font-bold text-gray-700 text-xs">'+i[0]+'</span><span class="font-black text-pink-500 text-lg">'+i[1]+'ê°œ</span></div>'});
        if(!sh)sh='<p class="text-[10px] text-gray-300 italic text-center">ë°ì´í„° ì—†ìŒ</p>';
        var rw='';[].concat(app.bail).reverse().forEach(function(h){rw+='<tr class="hover:bg-gray-50 border-b border-gray-50 h-12 font-bold text-xs"><td class="p-4 font-mono text-gray-400 text-[10px]">'+h.date+'</td><td class="p-4 text-gray-700">'+h.payer+'</td><td class="p-4 text-blue-500">'+h.receiver+'</td><td class="p-4 text-right text-pink-500">'+h.amount+'ê°œ</td></tr>'});
        if(!rw)rw='<tr><td colspan="4" class="p-20 text-center text-gray-300 font-bold italic">ë‚´ì—­ì´ ì—†ìŠµë‹ˆë‹¤.</td></tr>';
        c.innerHTML='<div class="grid grid-cols-1 lg:grid-cols-3 gap-6 lg:gap-8 fade-in h-full">'
            +'<div class="lg:col-span-1 bg-white p-8 lg:p-10 rounded-[2.5rem] lg:rounded-[3rem] border border-gray-100 shadow-sm flex flex-col h-full overflow-hidden"><div class="mb-8"><h3 class="text-xl font-bold text-gray-800 tracking-tight">ë³´ì„ê¸ˆ í˜„í™©</h3><p class="text-xs text-gray-400 mt-1 uppercase font-bold tracking-widest">GEM BAIL STATUS</p></div><div class="space-y-6 flex-1 overflow-y-auto pb-6"><div class="bg-pink-50 rounded-2xl p-6 text-center border border-pink-100"><p class="text-[10px] text-pink-500 font-bold uppercase tracking-widest mb-1">ì´ ë‚©ë¶€ ê±´ìˆ˜</p><h4 class="text-3xl font-black text-pink-600 tracking-tighter">'+app.bail.length+'</h4></div><h4 class="text-xs font-bold text-gray-400 uppercase tracking-widest">ê°„ë¶€ë³„ ìˆ˜ë ¹ ì´ê³„</h4><div class="grid grid-cols-1 gap-2">'+sh+'</div></div></div>'
            +'<div class="lg:col-span-2 bg-white rounded-[2.5rem] lg:rounded-[3rem] border border-gray-100 shadow-sm flex flex-col overflow-hidden h-full"><div class="p-6 lg:p-8 border-b border-gray-50 flex justify-between items-center"><h3 class="text-sm font-bold text-gray-800 uppercase tracking-widest">ë³´ì„ê¸ˆ ë‚©ë¶€ ì´ë ¥</h3><span class="text-[10px] text-gray-400 font-bold italic">Total: '+app.bail.length+'</span></div><div class="flex-1 overflow-y-auto"><table class="w-full text-left text-xs"><thead class="bg-gray-50 text-[10px] font-bold text-gray-500 uppercase sticky top-0"><tr><th class="p-5">ë‚ ì§œ</th><th class="p-5">ë‚©ë¶€ì</th><th class="p-5">ìˆ˜ë ¹ì</th><th class="p-5 text-right">ìˆ˜ëŸ‰</th></tr></thead><tbody class="divide-y divide-gray-50">'+rw+'</tbody></table></div></div></div>';
    }

    // === PENALTY ===
    function renderPenalty(c){
        var pc={};app.penalty.forEach(function(h){var p=Number(h.points)||0;pc[h.name]=(pc[h.name]||0)+p});
        var tg=Object.entries(pc).filter(function(x){return x[1]>0}).sort(function(a,b){return b[1]-a[1]});
        var cards='';if(!tg.length)cards='<p class="text-xs text-gray-400 font-bold italic py-4">í˜„ì¬ ë²Œì  ëŒ€ìƒìê°€ ì—†ìŠµë‹ˆë‹¤.</p>';else tg.forEach(function(x){cards+='<div class="bg-red-50 px-5 py-3 rounded-full border border-red-100 flex items-center gap-3 shrink-0"><div class="w-8 h-8 rounded-full bg-white flex items-center justify-center text-red-500 font-bold text-sm shadow-sm">'+x[1]+'</div><span class="text-red-300 font-bold text-xs tracking-[0.2em]">******</span></div>'});
        var rw='';[].concat(app.penalty).reverse().forEach(function(h){rw+='<tr class="hover:bg-gray-50 border-b border-gray-50 h-12 font-bold text-xs"><td class="p-4 text-gray-300 text-[10px] tracking-widest">**-**-**</td><td class="p-4 text-gray-300 tracking-widest">******</td><td class="p-4 text-red-500 font-black">'+h.points+'ì </td><td class="p-4 text-gray-300 text-[10px]">ë¹„ê³µê°œ ì‚¬ìœ </td></tr>'});
        if(!rw)rw='<tr><td colspan="4" class="p-20 text-center text-gray-300 font-bold italic">ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤.</td></tr>';
        c.innerHTML='<div class="flex flex-col gap-6 lg:gap-8 fade-in h-full"><div class="bg-white p-6 lg:p-8 rounded-[2rem] lg:rounded-[2.5rem] border border-gray-100 shadow-sm shrink-0"><div class="mb-4"><h3 class="text-sm font-bold text-gray-800 uppercase tracking-widest">í˜„ì¬ ë²Œì  ê´€ë¦¬ ëŒ€ìƒì í˜„í™©</h3></div><div class="flex gap-3 overflow-x-auto no-scrollbar pb-2">'+cards+'</div></div><div class="bg-white rounded-[2rem] lg:rounded-[2.5rem] border border-gray-100 shadow-sm flex flex-col flex-1 overflow-hidden"><div class="p-6 lg:p-8 border-b border-gray-50"><h3 class="text-sm font-bold text-gray-800 uppercase tracking-widest">ìƒì„¸ ë¶€ì—¬ ì´ë ¥</h3></div><div class="flex-1 overflow-y-auto"><table class="w-full text-left text-xs whitespace-nowrap"><thead class="bg-gray-50 text-[10px] font-bold text-gray-500 uppercase sticky top-0"><tr><th class="p-5">ë‚ ì§œ (ë¹„ê³µê°œ)</th><th class="p-5">ëŒ€ìƒì (ë¹„ê³µê°œ)</th><th class="p-5">ì ìˆ˜</th><th class="p-5">ë¶€ì—¬ ì‚¬ìœ  (ë¹„ê³µê°œ)</th></tr></thead><tbody class="divide-y divide-gray-50">'+rw+'</tbody></table></div></div></div>';
    }

    // === INIT ===
    (function(){
        var sb=document.getElementById('sidebar'),ov=document.getElementById('sidebarOverlay');
        document.getElementById('openSidebar').onclick=function(){sb.classList.remove('-translate-x-full');ov.classList.remove('hidden')};
        document.getElementById('closeSidebar').onclick=function(){sb.classList.add('-translate-x-full');ov.classList.add('hidden')};
        ov.onclick=function(){sb.classList.add('-translate-x-full');ov.classList.add('hidden')};
        fetchData();
    })();
    </script>
</body>
</html>
